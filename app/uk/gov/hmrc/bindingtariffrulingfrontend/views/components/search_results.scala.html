@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.twirl.api.HtmlFormat
@import uk.gov.hmrc.bindingtariffrulingfrontend.config.AppConfig
@import uk.gov.hmrc.bindingtariffrulingfrontend.connector.model.FileMetadata
@import uk.gov.hmrc.bindingtariffrulingfrontend.controllers.forms.SimpleSearch
@import uk.gov.hmrc.bindingtariffrulingfrontend.controllers.routes
@import uk.gov.hmrc.bindingtariffrulingfrontend.model.{Paged, Ruling}
@import uk.gov.hmrc.bindingtariffrulingfrontend.utils.{Dates, GlobalTariff}
@import uk.gov.hmrc.govukfrontend.views.html.components._

@this(
  govukSummaryList: GovukSummaryList,
)

@(search: Option[SimpleSearch], results: Paged[Ruling], fileMetadata: Map[String, FileMetadata])(implicit messages: Messages, appConfig: AppConfig)

@rulingImages(result: Ruling) = {
  @result.images.map { id =>
      @fileMetadata.get(id).map { meta =>
          @meta.fileName.map { fileName =>
              @meta.url.map { url =>
                  <a href="@routes.ImageController.get(result.reference, id)">
                      <img class="image-thumbnail" alt="@fileName" src="@url" />
                  </a>
              }
          }.getOrElse {
              HtmlFormat.empty
          }
      }
  }
}

@if(results.nonEmpty) {
  <ol id="search_results-list" class="govuk-list">
    @for((result: Ruling, index: Int) <- results.results.zipWithIndex) {
      <li id="search_results-list-@index" class="border-bottom">
        <div class="mb-1">
          @messages("search.results.ruling.reference")
          <a href="@routes.RulingController.get(result.reference)">@result.reference</a>
        </div>
        <div class="mb-1">
            @result.goodsDescription
        </div>
        <div class="mb-1">
          @messages("search.results.ruling.commodityCode")
          <a href="@GlobalTariff.link(result.bindingCommodityCode)" target="_blank">
              @result.bindingCommodityCode @messages("search.results.ruling.commodityCode.newTab")
          </a>
        </div>
        <div class="mb-1">
          @rulingImages(result)
        </div>
        <div class="mb-1" id="search_results-list-@index-end_date">
          @messages("search.results.ruling.expiryDate")
          @Dates.format(result.effectiveEndDate)
        </div>
      </li>
    }
  </ol>
                @*<dl>
                    <dt>

                    </dt>
                </dl>
                    <div class="mb-1">
                        @messages("search.results.ruling.reference")

                    </div>
                    <div class="mb-1">
                        @result.goodsDescription
                    </div>
                    <div class="mb-1">
                    </div>
                    <div class="mb-1">
                    </div>
                    <div class="mb-1">
                    </div>
                    <div class="mb-1">
                    </div>
                </td>
                <td class="valign-top" id="search_results-table-row_@index-end_date">
                </td>
                <td class="valign-top">
                    <a class="font-bold" href="@routes.RulingController.get(result.reference)">
                        @messages("search.results.ruling.view")
                    </a>
                </td>
            </tr>*@
}

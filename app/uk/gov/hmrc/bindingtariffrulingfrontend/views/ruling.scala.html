@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.bindingtariffrulingfrontend.config.AppConfig
@import uk.gov.hmrc.bindingtariffrulingfrontend.connector.model.FileMetadata
@import uk.gov.hmrc.bindingtariffrulingfrontend.controllers.routes
@import uk.gov.hmrc.bindingtariffrulingfrontend.model.Ruling
@import uk.gov.hmrc.bindingtariffrulingfrontend.utils.{Dates, GlobalTariff}
@import uk.gov.hmrc.bindingtariffrulingfrontend.views.html.template.main_template

@import uk.gov.hmrc.bindingtariffrulingfrontend.views.html.components.back_link

@(ruling: Ruling, fileMetadata: Map[String, FileMetadata])(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@main_template(title = Some(messages("ruling.title")), bodyClasses = None) {

@back_link()

 <div class="heading-xlarge">
  <span class="heading-secondary">
   @messages("site.heading.secondary")
  </span>
  <h1 id="ruling-heading" class="mt-0 heading-xlarge">
   @messages("ruling.heading", ruling.reference)
  </h1>
 </div>

 <button class="button-gray" onclick="window.print()">@messages("ruling.printRuling")</button>
@* <button class="button-gray">@messages("ruling.downloadRuling")</button>*@

 <table id="ruling-details" class="mt-2">
  <thead>
   <tr>
    <th width="30%"></th>
    <th></th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <th scope="row" class="font-bold">@messages("ruling.startDate")</th>
    <td>@Dates.format(ruling.effectiveStartDate)</td>
   </tr>
   <tr>
    <th scope="row" class="font-bold">@messages("ruling.expiryDate")</th>
    <td>@Dates.format(ruling.effectiveEndDate)</td>
   </tr>
   <tr>
    <th scope="row" class="font-bold">@messages("ruling.commodityCode")</th>
    <td>
     <a href="@GlobalTariff.link(ruling.bindingCommodityCode)" target="_blank">
      @ruling.bindingCommodityCode @messages("search.results.ruling.commodityCode.newTab")
     </a>
    </td>
   </tr>
   <tr>
    <th scope="row" class="font-bold">@messages("ruling.description")</th>
    <td>@ruling.goodsDescription</td>
   </tr>
   @if(ruling.keywords.nonEmpty) {
    <tr>
     <th scope="row" class="font-bold">@messages("ruling.keywords")</th>
     <td>
     @ruling.keywords.map { keyword =>
      <span class="govuk-tag govuk-tag--grey">@keyword</span>
     }
     </td>
    </tr>
   }
   @if(ruling.images.nonEmpty) {
    <tr>
      <th scope="row" class="font-bold">@messages("ruling.images")</th>
      <td>
        @ruling.images.map { id =>
            @fileMetadata.get(id).map { meta =>
              @meta.fileName.map { fileName =>
                <a href="@routes.ImageController.get(ruling.reference, id)">
                    <img class="image-thumbnail-large"
                         alt="@fileName"
                         src="@routes.AttachmentController.get(ruling.reference, id)" />
                </a>
              }.getOrElse {
                HtmlFormat.empty
              }
            }
        }
      </td>
    </tr>
   }
   @if(ruling.attachments.nonEmpty) {
    <tr>
      <th scope="row" class="font-bold">@messages("ruling.attachments")</th>
        <td>
        <ul>
          @ruling.attachments.map { id =>
            @fileMetadata.get(id).map { meta =>
              @meta.fileName.map { fileName =>
                <li class="mb-1">
                  <a href="@routes.AttachmentController.get(ruling.reference, id)">@fileName</a>
                </li>
              }.getOrElse {
                HtmlFormat.empty
              }
            }
          }
        </ul>
      </td>
    </tr>
   }
   <tr>
    <th scope="row" class="font-bold">@messages("ruling.justification")</th>
    <td>@ruling.justification</td>
   </tr>
  </tbody>
 </table>

 <p>
  <h2 class="heading-medium">@messages("ruling.feedback.heading")</h2>
  <span><a href="#">@messages("ruling.feedback.link")</a> @messages("ruling.feedback.paragraph")</span>
 </p>

}
